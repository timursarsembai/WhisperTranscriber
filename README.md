# Desktop Whisper Transcriber

Портативное приложение для транскрибации аудио и видео с помощью ИИ (faster-whisper). Поддержка проектов, глобальных словарей, пресетов и постобработки текста.

## Основные возможности

- **Транскрипция**: поддержка многих языков (в т.ч. русский, арабский и др.). Работа на GPU (CUDA) или CPU.
- **Проекты (.wiproject)**: сохранение и загрузка сессии (аудио, транскрипт, выбранные словари). Один проект может содержать несколько файлов с разными транскриптами.
- **Глобальные словари**: общая папка словарей для всех проектов. Типы: *исправления* (original → corrected) и *термины* (подсказки для Whisper). В проекте сохраняются только ID включённых словарей. Пресеты наборов словарей, применение исправлений к тексту после транскрипции (опционально).
- **Редактор сегментов**: после транскрипции каждая строка — сегмент с кнопкой **Play** (воспроизведение этого фрагмента). Для воспроизведения опционально: `pip install pygame`.
- **Ollama**: коррекция текста через локальную LLM — предложения по сегментам, кнопки «Принять» / «Отклонить».
- **Микрофон**: запись в обычном и потоковом режиме, настройка усиления (программное и системное при наличии pycaw), осциллограф, таймер.
- **YouTube**: вставка ссылки и загрузка аудио (yt-dlp), далее транскрипция как у обычного файла.
- **Локализация**: интерфейс на английском, русском, испанском и казахском; выбор языка во вкладке «Интерфейс» (с флагом).
- **Строка состояния**: внизу окна отображается время последнего сохранения проекта.
- **Файлы проекта**: список файлов в папке проекта, переименование по месту, открытие в папке, кнопка «Обновить» для обновления списка после ручного добавления файлов.

Сборка в EXE: не требуется установка Python и библиотек; всё необходимое включается в сборку.

## Как пользоваться

1. Запустите `WhisperTranscriber.exe` (или `python main.py` в режиме разработки).
2. **Откройте проект** (файл .wiproject) или **создайте проект** (выберите папку).
3. Нажмите **«Добавить файл»** и выберите аудио/видео или запишите с микрофона / загрузите с YouTube.
4. Выберите модель (например, `base` — быстрее, `large-v3` — точнее) и при необходимости включите словари во вкладке «Настройки» → «Словари».
5. Нажмите **«Старт»** для транскрипции.
6. После завершения используйте **«Экспорт в TXT»** или **«Коррекция через Ollama»** при необходимости.
7. Сохраните проект (**«Сохранить проект»**), чтобы зафиксировать транскрипты и набор словарей.

## Системные требования

| Параметр | Минимум (tiny/base) | Рекомендуется (large-v3) |
| --- | --- | --- |
| **CPU** | 2 ядра (Intel i3 / Ryzen 3) | 4+ ядра (i5 / Ryzen 5) |
| **RAM** | 4 ГБ | 8 ГБ и более |
| **GPU** | NVIDIA с 2 ГБ VRAM (или режим CPU) | NVIDIA RTX с 6+ ГБ VRAM |
| **Диск** | ~500 МБ | ~5 ГБ (с учётом моделей) |
| **ОС** | Windows 10/11 (64-bit) | Windows 10/11 (64-bit) |

Для работы на GPU нужны актуальные драйверы **NVIDIA**. При отсутствии подходящей видеокарты используется режим CPU (медленнее).

## Структура проекта

- `main.py` — главное окно и логика UI (CustomTkinter).
- `TranscriptionService.py` — вызов Whisper и настройка DLL.
- `SessionService.py` — сохранение/загрузка проектов (.wiproject).
- `DictionaryService.py` — глобальные словари, prompt и постобработка.
- `GlossaryService.py` — совместимость со старым форматом глоссария.
- `ExportService.py` — экспорт в TXT и др.
- `OllamaService.py` — коррекция через Ollama.
- `i18n.py` — локализация и конфиг (wi_config.json, папка словарей).
- `build.py` — скрипт сборки EXE.
- `models/` — папка загружаемых моделей Whisper.
- `locales/` — файлы переводов (en, ru, es, kk).
- `tests/` — модульные тесты (pytest).

## Тестирование

Установка зависимостей для тестов:

```bash
pip install -r requirements-dev.txt
```

Запуск всех тестов из корня проекта:

```bash
python -m pytest tests/ -v
```

Покрытие кода (опционально):

```bash
python -m pytest tests/ -v --cov=. --cov-report=term-missing
```

Тесты охватывают: GlossaryService, SessionService, DictionaryService, ExportService, language_names (без внешних сервисов и UI).

## Дополнительные зависимости

- **YouTube и микрофон**: `pip install yt-dlp imageio-ffmpeg sounddevice soundfile` (или см. `requirements.txt`).
- **Воспроизведение сегментов**: `pip install pygame`.
- **Системная громкость микрофона (Windows)**: `pip install pycaw` (опционально).

## История изменений

Список изменений после первого коммита с кратким описанием добавленного функционала приведён в файле **[CHANGELOG_AFTER_FIRST.md](CHANGELOG_AFTER_FIRST.md)**. В начале файла указан последний учтённый коммит для последующего отслеживания.

## Технические детали

- **Стек**: Python 3.13, CustomTkinter, faster-whisper.
- **Портативность**: зависимости (в т.ч. CUDA DLL) упаковываются в EXE. Модели хранятся в папке `models` рядом с исполняемым файлом. Конфиг и папка глобальных словарей — рядом с EXE или со скриптом.
